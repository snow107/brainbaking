<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Unit Testing Extjs UI with Siesta</title>
  
  <meta name="author" content="Wouter Groeneveld"/>
  <meta name="generator" content="Hugo 0.21" />
  <link href='http://www.brainbaking.com//img/favicon.ico' rel='icon' type='image/x-icon'/>

  <link rel="alternate" href="http://www.brainbaking.com/index.xml" type="application/rss+xml" title="Brain Baking">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="http://www.brainbaking.com//css/bootstrap.min.css" />
  <link rel="stylesheet" href="http://www.brainbaking.com//css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="http://www.brainbaking.com//css/pygment_highlights.css" />
  <link rel="stylesheet" href="http://www.brainbaking.com/css/highlight.min.css">
  
  
  <meta property="og:title" content="Unit Testing Extjs UI with Siesta" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/post/unit-testing-extjs-ui/" />
  <meta property="og:image" content="/img/avatar-icon.png" />
  
</head>


  <body>

    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://www.brainbaking.com/">
        <i class="fa fa-lightbulb-o" aria-hidden="true"></i>&nbsp;&nbsp;
        Brain Baking
      </a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      <li id="google-search-wrapper">
	<script>
	(function() {
	  var cx = '015035874764642922467:uhhwew4ykvm';
	  var gcse = document.createElement('script');
	  gcse.type = 'text/javascript';
	  gcse.async = true;
	  gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
	  var s = document.getElementsByTagName('script')[0];
	  s.parentNode.insertBefore(gcse, s);
	})();
	</script>

	<gcse:search></gcse:search>

	<form onsubmit="return false;">
		<label for="searchInput"><i class="fa fa-search" aria-hidden="true"></i><span class="sr-only">Search</span></label>
		<input type="text" id="searchInput" placeholder="Search">
	</form>

	<script>
	(function() {
		document.querySelector('#searchInput').addEventListener("keypress", function(event) {
			if(event.keyCode === 13) {
				event.stopPropagation();
				document.querySelector('#___gcse_0 input').value = document.querySelector('#searchInput').value;
				document.querySelector('.gsc-search-button input').click();

				var modal = document.querySelector('.gsc-modal-background-image');
				modal.attributes['class'].value = "gsc-modal-background-image gsc-modal-background-image-visible";
			}
		});
	})();
	</script>
</li>

      
        
          <li class="navlinks-container">
            <a class="navlinks-parent" href="javascript:void(0)">Menu</a>
            <div class="navlinks-children">
            
              <a href="/wiki/"><i class='fa fa-wikipedia-w'></i>&nbsp;&nbsp;Wiki</a>
            
              <a href="/tags"><i class='fa fa-tags'></i>&nbsp;&nbsp;Tags</a>
            
              <a href="/about"><i class='fa fa-address-card-o'></i>&nbsp;&nbsp;About me</a>
            
              <a href="/talks"><i class='fa fa-graduation-cap'></i>&nbsp;&nbsp;Talks</a>
            
              <a href="/books"><i class='fa fa-book' aria-hidden='true'></i>&nbsp;&nbsp;Books</a>
            
            </div>
          </li>
        
      
      </ul>
    </div>

	<div class="avatar-container">
	  <div class="avatar-img-border">
      
          <a title="Brain Baking" href="http://www.brainbaking.com/">
              <img class="avatar-img" src="http://www.brainbaking.com//img/avatar-icon.png" alt="Brain Baking" />
          </a>
      
	  </div>
	</div>

  </div>
</nav>

    



  
    <div id="header-big-imgs" data-num-img=1 data-img-src-1="/img/Unit%20Testing%20Extjs%20UI%20with%20Siesta.jpg"></div>
  

  <header class="header-section has-img">
  
    <div class="big-img intro-header">
        <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>Unit Testing Extjs UI with Siesta</h1>
      
        
      <h2 class="post-subheading">An attempt to replace instable Webdriver tests with Siesta UI tests</h2>
      
      
      
      
      <span class="post-meta">23 December 2014</span>
      
        </div>
      </div>
    </div>
  </div>
      <span class='img-desc'></span>
    </div>
  
  <div class="intro-header no-img">
      <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>Unit Testing Extjs UI with Siesta</h1>
      
        
      <h2 class="post-subheading">An attempt to replace instable Webdriver tests with Siesta UI tests</h2>
      
      
      
      
      <span class="post-meta">23 December 2014</span>
      
        </div>
      </div>
    </div>
  </div>
  </div>
  </header>


    <div class="container" role="main">	  
      
        <div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      
  <i class="fa fa-tags" style="float: left;" aria-hidden="true"></i>
  <ul id="tags">
  
   <li><a href="/tags/tech">tech</a> </li>
  
   <li><a href="/tags/unit-testing">unit testing</a> </li>
  
   <li><a href="/tags/javascript">javascript</a> </li>
  
   <li><a href="/tags/extjs">extjs</a> </li>
  
   <li><a href="/tags/siesta">siesta</a> </li>
  
  </ul>



      <article role="main" class="blog-post">
          

<h3 id="webdriver-js-heavy-frameworks">WebDriver &amp; js-heavy frameworks</h3>

<p>Writing scenario tests for javascript-heavy UI webpages can be really difficult. It gets complicated pretty quickly if you&rsquo;re using a lot of async calls or a lot of javascript-heavy UI components. On our current project, we use Extjs as the UI layer in a single-page aspx page to bootstrap our Extjs app. Extjs is a (heavyweight) javascript framework for creating windows, panels, grids, buttons, menus, &hellip; like you&rsquo;re used to when using client/server desktop applications. You define components on a view, behavior on a controller, and data and the way it&rsquo;s loaded on the model.</p>

<p>The problem with Javascript-heavy frameworks like this is that if your team does not have a lot of experience using JS in general, it can get extremely messy and cluttered. Which it did, coupled with a lot of regression (a misplaced &ldquo;;&rdquo; could break an entire part of the application), we needed an automated way to catch up with those bugs.
Since I have a lot of experience with WebDriver, we started using it to write scenario tests when the application is deployed. A test should emulate customer behavior: click on a menu, expect a window to be opened, fill in a form and expect something else to happen. It&rsquo;s not isolated but tests everything together.</p>

<p>WebDriver is great, but since a lot of javascript events are happening in the background it&rsquo;s very difficult to write a easily usable DSL to manipulate the UI. One has to wait for ajax calls to finish, for DOM elements to appear or disappear, and so on. Tests became instable and failed sometimes, even sometimes on the CI build but never on your development environment. It takes more and more time to find &amp; fix those things.</p>

<h3 id="a-possible-solution-siesta">A possible solution: Siesta</h3>

<p><a href="http://www.bryntum.com/products/siesta/">Siesta</a> is a product from Bryntum especially written to unit test Extjs applications, focussing on the UI. Sounds nice, so we decided to check it out as a possible alternative to WebDriver. As the website states:</p>

<blockquote>
<p>Siesta is a JavaScript unit testing tool that can help you test any JavaScript code and also perform testing of the DOM and simulate user interactions. The tool can be used together with any type of JavaScript codebase â€“ jQuery, Ext JS, NodeJS, Dojo, YUI etc. Using the API, you can choose from many types of assertions ranging from simple logical JS object</p>
</blockquote>

<p>Sounds good, right?</p>

<p>The setup isn&rsquo;t too difficult, after a few hours of fiddling I managed to bootstrap our Extjs application using this index.js file:</p>

<p>var Harness = Siesta.Harness.Browser.ExtJS;</p>

<pre><code>    Harness.configure({
        title       : 'Test Suite',
        loaderPath  : { 
            'Ext': '../extjs',
            'Ext.ux': '../extjs/ux',
            'MyApp': '../app'
        },
        preload     : [
            // version of ExtJS used by your application
            '../extjs/resources/css/ext-all.css',
            '../resources/css/workb.css',

            // version of ExtJS used by your application
            '../extjs/ext-all-debug.js',
            './app-vars.js',
            {
                text: &quot;Ext.Loader.setConfig({ 'Ext': '../extjs', 'Ext.ux': '../extjs/ux', 'MyApp': '../app' })&quot;
            },
            '../extjs/overrides/javascript-overrides.js',
            '../extjs/overrides/PFW-overrides.js',
            '../app/app.js'
        ]
    });

    Harness.start(
        'tests/001_sanity.t.js',
        'tests/002_window.t.js'
    );
</code></pre>

<p>Some pitfalls: <code>loaderPath</code> isn&rsquo;t evaluated in the preload so you have to reset it with <code>Ext.Loader.setConfig()</code> and I had to alter our app.js file. Our directory structure looks like this:</p>

<p>root
&ndash; app
&ndash; extjs
&mdash;- ux
&ndash; siesta
&mdash;- tests</p>

<p>So you have to watch out for relative paths like <code>appFolder</code> in app.js:</p>

<pre><code>Ext.application({
    name: 'MyApp',
    appFolder: (_siesta ? '../' : '') + 'app',
</code></pre>

<p>After that, you can start writing tests. Looking at the examples, the test flow looks a lot like our current WebDriver tests (wait for rows present, wait x seconds, click on this, do that). Here&rsquo;s a simple test to create a view and check if the grid has some rows:</p>

<pre><code>StartTest(function(t) {
    t.diag(&quot;Creating some window&quot;);

    var view = Ext.create('MyApp.view.SomeOverview', {
        renderTo: Ext.getBody() // required
    });
    var grid = view.down(&quot;grid&quot;);

    t.chain(
        { waitFor : 'rowsVisible', args : grid }
    );
});
</code></pre>

<p><img src="{{urls.media}}/siesta.png" alt="siesta view test in action" /></p>

<p>Siesta also comes with it&rsquo;s downsides though.</p>

<ul>
<li>JS Test code is really messy. Chaining, async calls, ugly data setup for stores, &hellip; A simple test can get complicated fast and requires advanced JS knowledge not everybody in our team has.</li>
<li><code>waitFor</code> exposes the same problems we have with our current WebDriver tests, so it&rsquo;s not that much of an improvement</li>
<li>Test data setup cannot be reused from our backend integration tests (we use the builder pattern there to create data in the DB)</li>
<li>Creating a view to test doesn&rsquo;t test the controller and vice versa. Still too low level for us.</li>
</ul>

<p>The biggest problem is that it&rsquo;s still more an integration/unit test than a scenario test and quite tightly coupled to your implementation. Since our implementation is far from perfect, Siesta is not the optimal solution for us. For example, we create stores inside our views and load them in <code>initComponent()</code>. No way to provide a stub store with some dummy data. We&rsquo;d have to refactor 200+ views to create tests. Of course tests should be written before the implementation&hellip;</p>

<p>If you would like to know more about Siesta or JS BDD testing, take a look at</p>

<ul>
<li><a href="http://pivotallabs.com/sencha-touch-bdd-part-5-controller-testing/">Pivotallabs blog post</a></li>
<li><a href="http://www.bryntum.com/docs/siesta/#!/guide/siesta_getting_started">Siesta API doc: Getting started</a></li>
</ul>

      </article>

      <ul class="blog-pagination blog-pager">
        
        <li>
          &larr; Previous Post: <a href="http://www.brainbaking.com/post/memory-management-vs-java/" data-toggle="tooltip" data-placement="top" title=".NET Memory management VS JVM Memory management">.NET Memory management VS JVM Memory management</a>
          <span class="blog-pagination-date"> <i class="fa fa-calendar-o" aria-hidden="true"></i> 10/24/240106</span>
        </li>
        
        
        <li>
          &rarr; Next Post: <a href="http://www.brainbaking.com/post/webdriver-exception-handling/" data-toggle="tooltip" data-placement="top" title="Webdriver Exception Handling">Webdriver Exception Handling</a>
          <span class="blog-pagination-date"> <i class="fa fa-calendar-o" aria-hidden="true"></i> 01/14/140016</span>
        </li>
        
      </ul>

      <div class="disqus-comments">

	<div id="disqus_thread"></div>
	<script type="text/javascript">
		(function() {
		      
		      
		      if (window.location.hostname == "localhost")
		                return;

		      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		      var disqus_shortname = 'brainbaking';
		      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div>


    </div>
  </div>
</div>

      
    </div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
          <li>
            <a href="https://github.com/wgroeneveld" target="_blank" title="GitHub">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		      
		      
          <li>
            <a href="mailto:wouter.groeneveld@gmail.com" title="Email me">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		      
	    	  
          
           
          
          
          
          
          <li>
            <a href="https://www.pinterest.com/woutergroenev" target="_blank" title="Pinterest">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-pinterest fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li>
            <a href="https://www.goodreads.com/user/show/5451893-wouter" target="_blank" title="Goodreads">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-book fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          

    		  <li>
      			<a href="http://www.brainbaking.com/index.xml" title="RSS">
      			  <span class="fa-stack fa-lg">
        				<i class="fa fa-circle fa-stack-2x"></i>
        				<i class="fa fa-rss fa-stack-1x fa-inverse"></i>
      			  </span>
      			</a>
    		  </li>		

        </ul>
        <p class="credits copyright text-muted">
    	  <a href="http://www.brainbaking.com/about">Wouter Groeneveld</a>
    	  &nbsp;&bull;&nbsp;
    	  No copyright - <a href="https://github.com/wgroeneveld/brainbaking" target="_blank">Hack away!</a>
    		  
    	  
    	  &nbsp;&bull;&nbsp;
    	  <a href="http://www.brainbaking.com/">
          <i class="fa fa-lightbulb-o" aria-hidden="true"></i>&nbsp;Brain Baking
        </a>
    	  
  	    </p>
  	    
    	<p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.21</a> powered &nbsp;&bull;&nbsp; Theme by <a href="https://github.com/halogenica/beautifulhugo" target="_blank">Beautiful Hugo</a> adapted to <a href="https://github.com/wgroeneveld/beautifulbaking">Beautiful Baking</a>
          
    	</p>
      </div>
    </div>
  </div>
</footer>

<script src="http://www.brainbaking.com//js/jquery-1.11.2.min.js"></script>
<script src="http://www.brainbaking.com//js/bootstrap.min.js"></script>
<script src="http://www.brainbaking.com//js/main.js"></script>
<script src="http://www.brainbaking.com/js/highlight.min.js"></script>
<script async defer src="//assets.pinterest.com/js/pinit.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-45748221-1', 'auto');
ga('send', 'pageview');
</script>



  </body>
</html>
