<!DOCTYPE html>
<html lang="en-us">
    <head>
        <link rel="stylesheet" href="https://brainbaking.com/css/brainbaking.css">


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-45748221-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>


        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>C&#43;&#43; Basics: unit testing</title>
        
        <style>

    html body {
        font-family: 'Open Sans', sans-serif;
        background-color: white;
    }

    :root {
        --accent: purple;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="https://brainbaking.com/css/main.css">





<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open%20Sans">


 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/paraiso-dark.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
 


    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

     <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/cs.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/c.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scheme.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scala.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js"></script> 

    <script>hljs.initHighlightingOnLoad();</script>







<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>
 <meta name="generator" content="Hugo 0.39" />
        

        
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-45748221-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments)};
          gtag('js', new Date());

          gtag('config', 'UA-45748221-1');
        </script>
        
    </head>

    
    
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    

    <body>
         
        <nav class="navbar navbar-default navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">

                    <a class="navbar-brand visible-xs" href="#">C&#43;&#43; Basics: unit testing</a>

                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse">

                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/post"><i class='fa fa-file-code-o'></i>&nbsp;Tech Blog</a></li>
                            
                                <li><a href="/essays"><i class='fa fa-book'></i>&nbsp;Essays</a></li>
                            
                                <li><a href="/tags"><i class='fa fa-tags'></i>&nbsp;Tags</a></li>
                            
                        </ul>
                    

                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li><a href="/about"><i class='fa fa-user'></i>&nbsp;About Me</a></li>
                            
                                <li><a href="/teaching"><i class='fa fa-graduation-cap'></i>&nbsp;Teaching</a></li>
                            
                        </ul>
                    

                </div>

            </div>

        </nav>




<main>

    <div class="item">

    <h3>
        
        <a href="/post/cplusplus-testing/">C&#43;&#43; Basics: unit testing</a>
    </h3>

    
    
    
        <h4>C&#43;&#43; Basics: Unit Testing with GTest</h4>
        <h5>
        	<span style="color: grey;">
        		<i class='fa fa-calendar'></i>&nbsp;1 October 2013
    		</span>
    	</h5>
    


    
	   <i class='fa fa-tags' style='color: grey;'></i>&nbsp;
    
    
        <a href="https://brainbaking.com/tags/c&#43;&#43;"><kbd class="item-tag">c&#43;&#43;</kbd></a>
    
        <a href="https://brainbaking.com/tags/unit-testing"><kbd class="item-tag">Unit Testing</kbd></a>
    
        <a href="https://brainbaking.com/tags/gtest"><kbd class="item-tag">gtest</kbd></a>
    

</div>


    <br> <div class="text-justify">

<h2 id="using-google-test">Using Google Test</h2>

<p>Downloaden op <a href="https://code.google.com/p/googletest/downloads/list">https://code.google.com/p/googletest/downloads/list</a></p>

<p><strong>Waarom</strong>?</p>

<ol>
<li>Platform onafhankelijk</li>
<li>Snelheid</li>
<li>Geen gezeik met Managed C++, compatibel met &ldquo;eender wat&rdquo; (enige vereiste: <code>cc</code> compiler variant)</li>
<li>Wordt veel gebruikt (Chromium, Stack overflow)</li>
</ol>

<p><strong>Waarom niet</strong>?</p>

<ol>
<li>slechte of geen integratie met VStudio (zie onder)</li>
<li>wéér een andere syntax dan MS .NET testen</li>
<li>beetje awkward assertions</li>
</ol>

<h4 id="assertions-schrijven">Assertions schrijven</h4>

<pre><code class="language-c">#include &quot;../BaseCode/BaseCode.h&quot;

#include &quot;gtest/gtest.h&quot;

TEST(MyTestCase, MyTest_Success)
{
    EXPECT_EQ(2, MySum(1, 1));
}

TEST(MyTestCase, MyTest_Failure)
{
    EXPECT_EQ(3, MySum(1, 2));
}
</code></pre>

<p>Waarbij dan <code>BaseCode</code> uw system under test zaken bevat (waar <code>MySum</code> defined is)</p>

<h4 id="builden-met-scons-en-g">Builden met scons en g++</h4>

<p>Tested in Cygwin Win7 &amp; OSX 10.9</p>

<pre><code class="language-python">Import('env')
env ###### env.Clone(CPPPATH  './:./include')

env.Append(CXXFLAGS = ['-g', '-Wall', '-Wextra', '-pthread'])
gtest ###### env.Library(target  'gtest', source = ['src/gtest-all.cc', 'src/gtest_main.cc'])

Return('gtest')
</code></pre>

<p>Zie <a href="/post/scons-building/">Builden met SCons</a></p>

<h4 id="builden-met-visual-studio">Builden met Visual Studio</h4>

<p><img style='float: left;' src='/img//code/c/testing/screenshot.png|'></p>

<p>Zie <a href="http://leefrancis.org/2010/11/17/google-test-gtest-setup-with-microsoft-visual-studio-2008-c/">http://leefrancis.org/2010/11/17/google-test-gtest-setup-with-microsoft-visual-studio-2008-c/</a></p>

<p>Er zijn 2 <code>.sln</code> files voorzien in de msvc subdir bij de zipfile, één voor statische links en één voor dynamische. Afhankelijk van uw project (.DLL of .LIB gegenereerde uitkomst), ga je één van beiden moeten compileren. Als je van plan bent om <code>/MDd</code> te gebruiken (dll + debugging), gebruik dan <code>gtest-md.sln</code>.</p>

<p>Daarna kan je een nieuwe solution maken, package naar executable om de test zelf te runnen (om gtest testen te draaien). Verander deze dingen in het project:</p>

<ol>
<li>General &gt; Configuration type  = Application (.EXE)</li>
<li>C/C++ &gt; General &gt; Additional Include dirs naar gtest/include verwijzen</li>
<li>C/C++ &gt; Preprocessor &gt; definitions toevoegen <code>_VARIADIC_MAX=10</code></li>
<li>Code generation &gt; Runtime library op <code>/MDd</code> of <code>/MTd</code> juist zetten (zie boven)</li>
<li>Linker &gt; Additional Library directories &gt; gtest/Debug (staan reeds binaries indien compiled)</li>
<li>Linker &gt; Input &gt; Additional dependencies = gtestd.lib;gtest_maind.lib;(rest)</li>
<li>Linker &gt; System &gt; SubSystem Console <code>/SYBSYSTEM:CONSOLE</code></li>
<li>Linker &gt; Input &gt; Module Definition file leeg (indien van DLL naar EXE veranderd kan hier wat brol in zitten)</li>
</ol>

<h4 id="visual-studio-2012-en-std-problemen">Visual Studio 2012 en STD problemen</h4>

<p>Fouten als</p>

<pre><code>1&gt;a:&lt;br/&gt;gtest&lt;br/&gt;include&lt;br/&gt;gtest&lt;br/&gt;gtest-printers.h(550): error C2977: 'std::tuple' : too many template arguments
1&gt;          b:&lt;br/&gt;program files (x86)&lt;br/&gt;microsoft visual studio 2012&lt;br/&gt;vc&lt;br/&gt;include&lt;br/&gt;utility(73) : see declaration of 'std::tuple'
</code></pre>

<p>Op te lossen met een preprocessor macro _VARIADIC_MAX=10, zie <a href="http://stackoverflow.com/questions/12558327/google-test-in-visual-studio-2012">http://stackoverflow.com/questions/12558327/google-test-in-visual-studio-2012</a></p>

<h5 id="integratie-met-visual-studio-2008-2010">Integratie met Visual Studio <sup>2008</sup>&frasl;<sub>2010</sub></h5>

<p><a href="http://googletestaddin.codeplex.com/documentation">GoogleTestAddin</a> (kopieer 2 files naar C:\Users\bkwog\Documents\Visual Studio 2008\Addins, map misschien nog aanmaken)</p>

<p>Niet super nuttig, een knopje om testen snel te herdraaien (of één die geselecteerd is), beter dan post-build actie zie boven&hellip;</p>

<h4 id="integratie-met-visual-studio-2012">Integratie met Visual Studio 2012</h4>

<p><a href="http://visualstudiogallery.msdn.microsoft.com/f00c0f72-ac71-4c80-bf8b-6fe381548031">Google Test Adapter</a> plugin (1.1 - geen actieve development?)</p>
</div>

    
    

    

        <h4 class="page-header"><i class="fa fa-newspaper-o"></i>&nbsp;Related by Tags</h4>

        <div class="text-justify">
             <div class="item">

    <h4><a href="/post/scheme/">Scheme tips and tricks</a></h4>

    
    
    
        Unit testing in Scheme <span style="color: lightgrey;"><i class='fa fa-calendar'></i>&nbsp;1 October 2013</span>
    

</div>
  <div class="item">

    <h4><a href="/post/cplusplus-basics/">C&#43;&#43; Basics</a></h4>

    
    
    
        C&#43;&#43; basics for a Java developer <span style="color: lightgrey;"><i class='fa fa-calendar'></i>&nbsp;1 October 2013</span>
    

</div>
 
        </div>

        <hr/>

    

    
    <h4 class="page-header"><i class="fa fa-comments-o"></i>&nbsp;Join the Discussion on 
        <a href="https://twitter.com/woutergroenev">Twitter</a>!</h4>

    

</main>

        <footer>

            <p class="copyright text-muted">No <i class='fa fa-copyright'></i> reserved - sharing is caring. <i class='fa fa-github'></i> <a href='https://github.com/wgroeneveld/brainbaking/'>Hack away</a>! <i class='fa fa-lightbulb-o'></i> <a href='/'>Brain Baking</a></p>

        </footer>
       
    </body>

</html>

